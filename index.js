(()=>{var B=Object.defineProperty,V=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var C=(n,t,e)=>t in n?B(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,R=(n,t)=>{for(var e in t||(t={}))j.call(t,e)&&C(n,e,t[e]);if(P)for(var e of P(t))z.call(t,e)&&C(n,e,t[e]);return n},A=(n,t)=>V(n,X(t));function N(i,t,l,r){var a=6371,o=L(l-i),s=L(r-t),i=L(i),l=L(l),m=Math.sin(o/2)*Math.sin(o/2)+Math.sin(s/2)*Math.sin(s/2)*Math.cos(i)*Math.cos(l),d=2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m)),c=a*d;return c}function L(n){return n*Math.PI/180}var b=n=>n.replace("Walt Disney's","").replace("Disney's","").replace("Water Park","").replace("Theme Park","").replace("Walt Disney World","").replace("Park","").replace(/\s+/," ").trim(),Y=n=>n.liveData.filter(t=>t.entityType==="PARK").map(t=>({id:t.id,name:b(t.name)})),F=(n,t)=>n.liveData.filter(e=>e.entityType==="ATTRACTION"&&e.parkId===t).map(e=>{var r,a,o,s,i;return{id:e.id,name:b(e.name),standbyWait:(o=(a=(r=e.queue)==null?void 0:r.STANDBY)==null?void 0:a.waitTime)!=null?o:null,returnStart:(i=(s=e.queue)==null?void 0:s.RETURN_TIME)!=null&&i.returnStart?new Date(e.queue.RETURN_TIME.returnStart):null}}),K=(n,t)=>n.liveData.filter(e=>e.entityType==="RESTAURANT"&&e.parkId===t).map(e=>{var r,a,o,s,i;return{id:e.id,name:b(e.name),standbyWait:(o=(a=(r=e.queue)==null?void 0:r.STANDBY)==null?void 0:a.waitTime)!=null?o:null,partyWait:(i=(s=e.diningAvailability)==null?void 0:s.map(l=>[l.partySize,l.waitTime]))!=null?i:[]}}),G=(n,t)=>n.liveData.filter(e=>e.entityType==="SHOW"&&e.parkId===t).map(e=>{var r,a,o,s,i;return{id:e.id,name:b(e.name),standbyWait:(o=(a=(r=e.queue)==null?void 0:r.STANDBY)==null?void 0:a.waitTime)!=null?o:null,returnStart:(i=(s=e.queue)==null?void 0:s.RETURN_TIME)!=null&&i.returnStart?new Date(e.queue.RETURN_TIME.returnStart):null,showTimes:e.showtimes?e.showtimes.map(l=>new Date(l.startTime)):[]}}),y=(n,t)=>A(R({},n),{location:t[n.id]}),g=(n,t)=>A(R({},n),{distance:t&&n.location?N(n.location[0],n.location[1],t[0],t[1]):null}),v=n=>n.concat().sort((t,e)=>{var r,a;return((r=t.standbyWait)!=null?r:Number.MAX_VALUE)-((a=e.standbyWait)!=null?a:Number.MAX_VALUE)}),w=n=>n.concat().sort((t,e)=>{var r,a,o,s;return((a=(r=t.returnStart)==null?void 0:r.getTime())!=null?a:Number.MAX_VALUE)-((s=(o=e.returnStart)==null?void 0:o.getTime())!=null?s:Number.MAX_VALUE)}),f=n=>n.concat().sort((t,e)=>{var r,a;return((r=t.distance)!=null?r:Number.MAX_VALUE)-((a=e.distance)!=null?a:Number.MAX_VALUE)}),O=n=>{let t={parks:Y(n),parkAttractions:{},parkRestaurants:{},parkShows:{}};return t.parks.forEach(e=>{t.parkAttractions[e.id]=F(n,e.id),t.parkRestaurants[e.id]=K(n,e.id),t.parkShows[e.id]=G(n,e.id)}),t};var J="https://api.themeparks.wiki/v1/entity/e957da41-3552-4cf6-b636-5babc5cbc4e5/live",Q=n=>"https://api.themeparks.wiki/v1/entity/".concat(n),u=null,T=null,D="SHORTEST",M="SHORTEST",W="SHORTEST",h=null,E={},S=document.querySelector("#park-list"),k=document.querySelector("#attraction-list"),q=document.querySelector("#attraction-list-options"),x=document.querySelector("#restaurant-list"),$=document.querySelector("#restaurant-list-options"),H=document.querySelector("#show-list"),I=document.querySelector("#show-list-options"),Z=()=>{S&&(S.addEventListener("change",n=>{T=n.target.value,p(u)}),q&&(q.addEventListener("change",n=>{D=n.target.value,p(u)}),I&&(I.addEventListener("change",n=>{M=n.target.value,p(u)}),$&&($.addEventListener("change",n=>{W=n.target.value,p(u)}),navigator.geolocation&&(navigator.geolocation.getCurrentPosition(n=>{h=[n.coords.latitude,n.coords.longitude],p(u)}),navigator.geolocation.watchPosition(n=>{h=[n.coords.latitude,n.coords.longitude],p(u)}))))))},U=async()=>fetch(J).then(n=>(console.log("data loaded ".concat(new Date)),n.json())).catch(n=>(alert("Failed to load data: ".concat(n)),null)),tt=async n=>fetch(Q(n)).then(t=>t.json()).then(t=>E[n]=[t.location.latitude,t.location.longitude]).catch(()=>null),et=async()=>{if(!u)return;let t=u.liveData.filter(r=>r.parkId===T).find(r=>!Object.keys(E).includes(r.id));if(!t)return;let e=await tt(t.id);e&&(E[t.id]=e),p(u)},_=n=>(u=n||u,u),p=n=>{if(!n)return;let t=O(n);T||(T=t.parks[0].id),nt(t.parks);let a=t.parkAttractions[T].map(c=>y(c,E)).map(c=>g(c,h));D==="SHORTEST"?a=v(a):D==="SOONEST"?a=w(a):D==="NEAREST"&&(a=f(a)),at(a);let i=t.parkRestaurants[T].map(c=>y(c,E)).map(c=>g(c,h));W==="SHORTEST"?i=v(i):W==="NEAREST"&&(i=f(i)),it(i);let d=t.parkShows[T].map(c=>y(c,E)).map(c=>g(c,h));M==="SHORTEST"?d=v(d):M==="SOONEST"?d=w(d):M==="NEAREST"&&(d=f(d)),rt(d)},nt=n=>{S&&(S.innerHTML="",n.forEach(t=>{let e=document.createElement("option");e.innerText=t.name,e.value=t.id,e.selected=t.id===T,S.appendChild(e)}))},at=n=>{k&&(k.innerHTML="",n.forEach(t=>{var i,l,m;let e=document.createElement("tr"),r=document.createElement("td");r.innerText=t.name,e.appendChild(r);let a=document.createElement("td");a.innerText="".concat((i=t.standbyWait)!=null?i:""),e.appendChild(a);let o=document.createElement("td");o.innerText="".concat((m=(l=t.returnStart)==null?void 0:l.toLocaleTimeString())!=null?m:""),e.appendChild(o);let s=document.createElement("td");s.innerText="".concat(t.distance?Math.round(t.distance*1e3):""),e.appendChild(s),k.appendChild(e)}))},rt=n=>{H&&(H.innerHTML="",n.forEach(t=>{var l,m,d;let e=document.createElement("tr"),r=document.createElement("td");r.innerText=t.name,e.appendChild(r);let a=document.createElement("td");a.innerText="".concat((l=t.standbyWait)!=null?l:""),e.appendChild(a);let o=document.createElement("td");o.innerText="".concat((d=(m=t.returnStart)==null?void 0:m.toLocaleTimeString())!=null?d:""),e.appendChild(o);let s=document.createElement("td");s.innerHTML=t.showTimes.map(c=>"<div>".concat(c.toLocaleTimeString(),"</div>")).join(""),e.appendChild(s);let i=document.createElement("td");i.innerText="".concat(t.distance?Math.round(t.distance*1e3):""),e.appendChild(i),H.appendChild(e)}))},it=n=>{x&&(x.innerHTML="",n.forEach(t=>{var i;let e=document.createElement("tr"),r=document.createElement("td");r.innerText=t.name,e.appendChild(r);let a=document.createElement("td");a.innerText="".concat((i=t.standbyWait)!=null?i:""),e.appendChild(a);let o=document.createElement("td");o.innerHTML=t.partyWait.map(l=>"<div>".concat(l[0],":").concat(l[1],"</div>")).join(""),e.appendChild(o);let s=document.createElement("td");s.innerText="".concat(t.distance?Math.round(t.distance*1e3):""),e.appendChild(s),x.appendChild(e)}))};Z();setInterval(()=>U().then(_).then(p),6e4);U().then(_).then(p);setInterval(()=>et(),500);})();
//# sourceMappingURL=index.js.map
